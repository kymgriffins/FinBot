{% extends "base.html" %}

{% block title %}ICT Trading Journal - FinBot{% endblock %}

{% block extra_css %}
<style>
  .trade-card {
    transition: all 0.3s ease;
    border: 1px solid #e5e7eb;
  }

  .trade-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
  }

  .winning-trade {
    border-left: 4px solid #10b981;
    background: linear-gradient(90deg, rgba(16, 185, 129, 0.1) 0%, transparent 100%);
  }

  .losing-trade {
    border-left: 4px solid #ef4444;
    background: linear-gradient(90deg, rgba(239, 68, 68, 0.1) 0%, transparent 100%);
  }

  .pending-trade {
    border-left: 4px solid #f59e0b;
    background: linear-gradient(90deg, rgba(245, 158, 11, 0.1) 0%, transparent 100%);
  }

  .stats-card {
    background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
    border: 1px solid #cbd5e1;
  }
</style>
{% endblock %}

{% block content %}
<!-- Breadcrumb Navigation -->
<div class="mb-6">
  <nav class="flex" aria-label="Breadcrumb">
    <ol class="inline-flex items-center space-x-1 md:space-x-3">
      <li class="inline-flex items-center">
        <a href="{{ url_for('web.dashboard') }}" class="inline-flex items-center text-sm font-medium text-gray-700 hover:text-blue-600">
          <i class="fas fa-home mr-2"></i>
          Dashboard
        </a>
      </li>
      <li>
        <div class="flex items-center">
          <i class="fas fa-chevron-right text-gray-400 mx-1"></i>
          <a href="/api/ict/" class="ml-1 text-sm font-medium text-gray-700 hover:text-blue-600 md:ml-2">ICT Trading</a>
        </div>
      </li>
      <li>
        <div class="flex items-center">
          <i class="fas fa-chevron-right text-gray-400 mx-1"></i>
          <span class="ml-1 text-sm font-medium text-gray-500 md:ml-2">Trading Journal</span>
        </div>
      </li>
    </ol>
  </nav>
</div>

<!-- Page Header -->
<div class="mb-8">
  <div class="flex flex-col md:flex-row md:items-center md:justify-between">
    <div>
      <h1 class="text-3xl font-bold text-gray-900 mb-2">ICT Trading Journal</h1>
      <p class="text-gray-600">Track your trades, analyze performance, and improve your ICT strategy</p>
    </div>
    <div class="mt-4 md:mt-0 flex space-x-3">
      <a href="/api/ict/" class="btn-secondary">
        <i class="fas fa-chart-candlestick mr-2"></i>Dashboard
      </a>
      <a href="/api/ict/backtest" class="btn-secondary">
        <i class="fas fa-chart-line mr-2"></i>Backtesting
      </a>
      <a href="/api/ict/market-overview" class="btn-secondary">
        <i class="fas fa-globe mr-2"></i>Market Overview
      </a>
    </div>
  </div>
</div>

        <!-- Control Panel -->
        <div class="bg-white rounded-2xl p-6 mb-6 shadow-sm">
            <div class="flex flex-col lg:flex-row justify-between items-start lg:items-center gap-4">
                <div class="flex-1">
                    <h2 class="text-2xl font-bold text-gray-800 mb-2">Add New Trade</h2>
                    <p class="text-gray-600">Record your ICT trading setups and outcomes</p>
                </div>
            </div>
        </div>

        <!-- Trade List -->
        <div class="bg-white rounded-2xl p-6 shadow-sm">
            <h2 class="text-2xl font-bold text-gray-800 mb-4">Recent Trades</h2>
            <div id="trades-list" class="space-y-4">
                <div class="text-center text-gray-500 py-8">
                    <i class="fas fa-spinner fa-spin text-2xl mb-2"></i>
                    <p>Loading trades...</p>
                </div>
            </div>
        </div>

        <!-- Stats -->
        <div class="bg-white rounded-2xl p-6 mt-6 shadow-sm">
            <h2 class="text-2xl font-bold text-gray-800 mb-4">Performance Statistics</h2>
            <div id="stats-container" class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div class="text-center text-gray-500 py-4">
                    <i class="fas fa-spinner fa-spin text-xl mb-2"></i>
                    <p>Loading stats...</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Load trades and stats
        async function loadData() {
            try {
                // Load trades
                const tradesResponse = await fetch('/api/ict/journal/trades');
                const tradesData = await tradesResponse.json();
                
                const tradesList = document.getElementById('trades-list');
                if (tradesData.trades && tradesData.trades.length > 0) {
                    tradesList.innerHTML = tradesData.trades.map(trade => `
                        <div class="border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow">
                            <div class="flex justify-between items-start">
                                <div>
                                    <h3 class="font-semibold text-gray-800">${trade.symbol}</h3>
                                    <p class="text-sm text-gray-600">${trade.date} at ${trade.entry_time}</p>
                                    <p class="text-sm text-gray-600">${trade.trade_type.toUpperCase()} - ${trade.position_size} contracts</p>
                                </div>
                                <div class="text-right">
                                    <p class="font-semibold text-gray-800">Entry: $${trade.entry_price}</p>
                                    ${trade.exit_price ? `<p class="text-sm text-gray-600">Exit: $${trade.exit_price}</p>` : ''}
                                    ${trade.pnl ? `<p class="font-semibold ${trade.pnl > 0 ? 'text-green-600' : 'text-red-600'}">$${trade.pnl}</p>` : ''}
                                </div>
                            </div>
                        </div>
                    `).join('');
                } else {
                    tradesList.innerHTML = '<div class="text-center text-gray-500 py-8"><p>No trades found. Add your first trade!</p></div>';
                }

                // Load stats
                const statsResponse = await fetch('/api/ict/journal/stats');
                const statsData = await statsResponse.json();
                
                const statsContainer = document.getElementById('stats-container');
                statsContainer.innerHTML = `
                    <div class="bg-blue-50 p-4 rounded-lg text-center">
                        <h3 class="text-lg font-semibold text-blue-800">Total Trades</h3>
                        <p class="text-2xl font-bold text-blue-600">${statsData.total_trades || 0}</p>
                    </div>
                    <div class="bg-green-50 p-4 rounded-lg text-center">
                        <h3 class="text-lg font-semibold text-green-800">Win Rate</h3>
                        <p class="text-2xl font-bold text-green-600">${((statsData.win_rate || 0) * 100).toFixed(1)}%</p>
                    </div>
                    <div class="bg-purple-50 p-4 rounded-lg text-center">
                        <h3 class="text-lg font-semibold text-purple-800">Total P&L</h3>
                        <p class="text-2xl font-bold text-purple-600">$${statsData.total_pnl || 0}</p>
                    </div>
                    <div class="bg-orange-50 p-4 rounded-lg text-center">
                        <h3 class="text-lg font-semibold text-orange-800">Profit Factor</h3>
                        <p class="text-2xl font-bold text-orange-600">${(statsData.profit_factor || 0).toFixed(2)}</p>
                    </div>
                `;
            } catch (error) {
                console.error('Error loading data:', error);
                document.getElementById('trades-list').innerHTML = '<div class="text-center text-red-500 py-8"><p>Error loading trades</p></div>';
                document.getElementById('stats-container').innerHTML = '<div class="text-center text-red-500 py-4"><p>Error loading stats</p></div>';
            }
        }

        // Load data when page loads
        document.addEventListener('DOMContentLoaded', loadData);
    </script>
{% endblock %}
